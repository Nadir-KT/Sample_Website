#!/usr/bin/env python3
"""
Requirement2Code - 100% Offline, No External Dependencies
Uses only built-in Python libraries - No external APIs or services
Run with: python requirement2code_offline.py
"""

import tkinter as tk
from tkinter import ttk, scrolledtext, messagebox
import re
import json
import datetime

class OfflineCodeGenerator:
    def __init__(self):
        # Comprehensive code templates database
        self.templates = {
            'python': self.get_python_templates(),
            'javascript': self.get_javascript_templates(),
            'java': self.get_java_templates(),
            'html': self.get_html_templates(),
            'sql': self.get_sql_templates(),
            'cpp': self.get_cpp_templates()
        }
        
        # Pattern matching rules
        self.pattern_rules = {
            'sort': ['sort', 'order', 'arrange', 'organize'],
            'api': ['api', 'fetch', 'http', 'request', 'endpoint'],
            'validation': ['valid', 'check', 'verify', 'email', 'password'],
            'calculator': ['calculator', 'add', 'subtract', 'multiply', 'divide'],
            'database': ['database', 'sql', 'query', 'select', 'insert'],
            'auth': ['auth', 'login', 'register', 'password', 'user'],
            'file': ['file', 'read', 'write', 'csv', 'json'],
            'string': ['string', 'parse', 'format', 'convert']
        }
    
    def detect_requirement_type(self, requirement):
        """Detect what type of code is needed based on keywords"""
        requirement_lower = requirement.lower()
        scores = {}
        
        for req_type, keywords in self.pattern_rules.items():
            score = sum(1 for keyword in keywords if keyword in requirement_lower)
            if score > 0:
                scores[req_type] = score
        
        if scores:
            return max(scores.items(), key=lambda x: x[1])[0]
        return 'generic'
    
    def generate_code(self, requirement, language):
        """Generate code based on requirement analysis"""
        req_type = self.detect_requirement_type(requirement)
        
        if language in self.templates and req_type in self.templates[language]:
            base_code = self.templates[language][req_type]
        else:
            base_code = self.templates.get(language, {}).get('generic', '// Code template not available')
        
        # Customize based on specific requirements
        customized_code = self.customize_code(base_code, requirement, language)
        return customized_code
    
    def customize_code(self, code, requirement, language):
        """Add basic customization based on requirement"""
        # Add requirement as comment
        if language in ['python', 'ruby']:
            comment = f'# Requirement: {requirement}\n#'
        elif language in ['javascript', 'java', 'cpp']:
            comment = f'// Requirement: {requirement}\n//'
        elif language == 'sql':
            comment = f'-- Requirement: {requirement}\n--'
        else:
            comment = f'<!-- Requirement: {requirement} -->\n'
        
        customized = f"{comment}\n{code}"
        return customized

    def get_python_templates(self):
        return {
            'sort': '''def sort_array(arr):
    """Sorts an array in ascending order with error handling"""
    if not isinstance(arr, list):
        raise TypeError("Input must be a list")
    return sorted(arr)

# Example usage:
# numbers = [3, 1, 4, 1, 5, 9, 2, 6, 5]
# sorted_numbers = sort_array(numbers)
# print(f"Sorted: {sorted_numbers}")''',

            'api': '''import requests

def fetch_data(url, timeout=10):
    """Fetch data from API with error handling"""
    try:
        response = requests.get(url, timeout=timeout)
        response.raise_for_status()
        return response.json()
    except requests.exceptions.RequestException as e:
        print(f"API request failed: {e}")
        return None

# Example usage:
# data = fetch_data("https://api.example.com/data")
# if data:
#     print(f"Received data: {data}")''',

            'validation': '''import re

def validate_email(email):
    """Validate email format using regex"""
    pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$'
    return bool(re.match(pattern, email))

def validate_password(password):
    """Validate password: at least 8 chars, 1 number, 1 uppercase"""
    if len(password) < 8:
        return False
    if not any(char.isdigit() for char in password):
        return False
    if not any(char.isupper() for char in password):
        return False
    return True

# Example usage:
# print(validate_email("test@example.com"))  # True
# print(validate_password("StrongPass123"))  # True''',

            'calculator': '''class Calculator:
    """Simple calculator with basic operations"""
    
    def add(self, a, b):
        return a + b
    
    def subtract(self, a, b):
        return a - b
    
    def multiply(self, a, b):
        return a * b
    
    def divide(self, a, b):
        if b == 0:
            raise ValueError("Cannot divide by zero")
        return a / b

# Example usage:
# calc = Calculator()
# result = calc.add(5, 3)
# print(f"5 + 3 = {result}")''',

            'database': '''import sqlite3

class DatabaseManager:
    def __init__(self, db_path):
        self.db_path = db_path
    
    def execute_query(self, query, params=None):
        """Execute SQL query and return results"""
        try:
            with sqlite3.connect(self.db_path) as conn:
                cursor = conn.cursor()
                if params:
                    cursor.execute(query, params)
                else:
                    cursor.execute(query)
                
                if query.strip().upper().startswith('SELECT'):
                    return cursor.fetchall()
                else:
                    conn.commit()
                    return cursor.rowcount
        except sqlite3.Error as e:
            print(f"Database error: {e}")
            return None

# Example usage:
# db = DatabaseManager('example.db')
# users = db.execute_query('SELECT * FROM users')''',

            'auth': '''import hashlib
import secrets

class AuthSystem:
    def __init__(self):
        self.users = {}
    
    def hash_password(self, password):
        """Hash password with salt"""
        salt = secrets.token_hex(16)
        return hashlib.sha256((password + salt).encode()).hexdigest() + ':' + salt
    
    def verify_password(self, password, hashed):
        """Verify password against hash"""
        stored_hash, salt = hashed.split(':')
        return hashlib.sha256((password + salt).encode()).hexdigest() == stored_hash
    
    def register(self, username, password):
        if username in self.users:
            return False
        self.users[username] = self.hash_password(password)
        return True
    
    def login(self, username, password):
        if username not in self.users:
            return False
        return self.verify_password(password, self.users[username])

# Example usage:
# auth = AuthSystem()
# auth.register("user1", "password123")
# print(auth.login("user1", "password123"))  # True''',

            'file': '''import csv
import json

def read_csv_file(filename):
    """Read CSV file and return data as list of dictionaries"""
    data = []
    try:
        with open(filename, 'r', newline='', encoding='utf-8') as file:
            reader = csv.DictReader(file)
            data = [row for row in reader]
    except FileNotFoundError:
        print(f"File {filename} not found")
    return data

def write_json_file(data, filename):
    """Write data to JSON file"""
    try:
        with open(filename, 'w', encoding='utf-8') as file:
            json.dump(data, file, indent=2)
        return True
    except Exception as e:
        print(f"Error writing file: {e}")
        return False

# Example usage:
# data = read_csv_file('data.csv')
# write_json_file(data, 'data.json')''',

            'generic': '''def process_requirement(input_data):
    """
    TODO: Implement your specific functionality here
    Add error handling, validation, and business logic as needed
    """
    # Your implementation goes here
    processed_data = input_data  # Replace with actual processing
    return processed_data

def main():
    """Main function to demonstrate usage"""
    sample_input = "example data"
    result = process_requirement(sample_input)
    print(f"Processing result: {result}")

if __name__ == "__main__":
    main()'''
        }
    
    def get_javascript_templates(self):
        return {
            'sort': '''function sortArray(arr) {
    if (!Array.isArray(arr)) {
        throw new Error('Input must be an array');
    }
    return arr.slice().sort((a, b) => a - b);
}

// Example usage:
// const numbers = [3, 1, 4, 1, 5, 9, 2, 6, 5];
// const sorted = sortArray(numbers);
// console.log('Sorted array:', sorted);''',

            'validation': '''function validateEmail(email) {
    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
    return emailRegex.test(email);
}

function validatePassword(password) {
    if (password.length < 8) return false;
    if (!/\\d/.test(password)) return false;
    if (!/[A-Z]/.test(password)) return false;
    return true;
}

// Example usage:
// console.log(validateEmail('test@example.com')); // true
// console.log(validatePassword('StrongPass123')); // true''',

            'generic': '''function processRequirement(inputData) {
    // TODO: Implement your specific functionality
    // Add error handling and business logic
    const result = inputData; // Replace with actual processing
    return result;
}

// Example usage:
// const result = processRequirement('example data');
// console.log('Result:', result);'''
        }
    
    def get_java_templates(self):
        return {
            'sort': '''import java.util.Arrays;

public class ArraySorter {
    public static int[] sortArray(int[] arr) {
        if (arr == null) {
            throw new IllegalArgumentException("Input array cannot be null");
        }
        int[] sorted = arr.clone();
        Arrays.sort(sorted);
        return sorted;
    }
    
    public static void main(String[] args) {
        int[] numbers = {3, 1, 4, 1, 5, 9, 2, 6, 5};
        int[] sorted = sortArray(numbers);
        System.out.println("Sorted array: " + Arrays.toString(sorted));
    }
}''',

            'generic': '''public class Solution {
    public static Object processRequirement(Object input) {
        // TODO: Implement your specific functionality
        // Add error handling and business logic
        Object result = input; // Replace with actual processing
        return result;
    }
    
    public static void main(String[] args) {
        Object input = "example data";
        Object result = processRequirement(input);
        System.out.println("Result: " + result);
    }
}'''
        }
    
    def get_html_templates(self):
        return {
            'generic': '''<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Your Application</h1>
        <p>Start building your HTML application here.</p>
    </div>
    
    <script>
        // Add your JavaScript functionality here
        console.log('Application loaded');
    </script>
</body>
</html>'''
        }
    
    def get_sql_templates(self):
        return {
            'database': '''-- Create table
CREATE TABLE users (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insert sample data
INSERT INTO users (username, email) VALUES 
('john_doe', 'john@example.com'),
('jane_smith', 'jane@example.com');

-- Select data
SELECT * FROM users WHERE username = 'john_doe';

-- Update data
UPDATE users SET email = 'new_email@example.com' WHERE username = 'john_doe';

-- Delete data
DELETE FROM users WHERE username = 'jane_smith';'''
        }
    
    def get_cpp_templates(self):
        return {
            'sort': '''#include <iostream>
#include <vector>
#include <algorithm>

std::vector<int> sortArray(std::vector<int> arr) {
    std::sort(arr.begin(), arr.end());
    return arr;
}

int main() {
    std::vector<int> numbers = {3, 1, 4, 1, 5, 9, 2, 6, 5};
    std::vector<int> sorted = sortArray(numbers);
    
    std::cout << "Sorted array: ";
    for (int num : sorted) {
        std::cout << num << " ";
    }
    std::cout << std::endl;
    
    return 0;
}''',

            'generic': '''#include <iostream>
#include <string>

class Solution {
public:
    std::string processRequirement(const std::string& input) {
        // TODO: Implement your specific functionality
        std::string result = input; // Replace with actual processing
        return result;
    }
};

int main() {
    Solution solution;
    std::string input = "example data";
    std::string result = solution.processRequirement(input);
    std::cout << "Result: " << result << std::endl;
    return 0;
}'''
        }

class Requirement2CodeOffline:
    def __init__(self, root):
        self.root = root
        self.root.title("ðŸš€ Requirement2Code - OFFLINE Edition")
        self.root.geometry("900x700")
        
        # Initialize code generator
        self.generator = OfflineCodeGenerator()
        
        self.setup_ui()
    
    def setup_ui(self):
        # Main container
        main_frame = ttk.Frame(self.root, padding="10")
        main_frame.grid(row=0, column=0, sticky=(tk.W, tk.E, tk.N, tk.S))
        
        # Header
        header_frame = ttk.Frame(main_frame)
        header_frame.grid(row=0, column=0, columnspan=2, sticky=(tk.W, tk.E), pady=(0, 20))
        
        ttk.Label(header_frame, text="ðŸš€ Requirement2Code", 
                 font=('Arial', 16, 'bold')).grid(row=0, column=0, sticky=tk.W)
        ttk.Label(header_frame, text="OFFLINE Edition - No External Dependencies", 
                 font=('Arial', 10), foreground='gray').grid(row=1, column=0, sticky=tk.W)
        
        # Input section
        input_frame = ttk.LabelFrame(main_frame, text="Describe Your Requirement", padding="15")
        input_frame.grid(row=1, column=0, sticky=(tk.W, tk.E, tk.N, tk.S), padx=(0, 10))
        
        self.requirement_text = scrolledtext.ScrolledText(input_frame, width=40, height=12, font=('Arial', 10))
        self.requirement_text.grid(row=0, column=0, columnspan=2, sticky=(tk.W, tk.E, tk.N, tk.S))
        self.requirement_text.insert('1.0', "Create a function that validates email addresses and returns true if valid")
        
        # Language selection
        ttk.Label(input_frame, text="Language:").grid(row=1, column=0, sticky=tk.W, pady=(10, 5))
        self.language_var = tk.StringVar(value='python')
        languages = ['python', 'javascript', 'java', 'html', 'sql', 'cpp']
        language_combo = ttk.Combobox(input_frame, textvariable=self.language_var, values=languages, state='readonly')
        language_combo.grid(row=1, column=1, sticky=(tk.W, tk.E), pady=(10, 5))
        
        # Generate button
        generate_btn = ttk.Button(input_frame, text="Generate Code", command=self.generate_code)
        generate_btn.grid(row=2, column=0, columnspan=2, pady=10, sticky=(tk.W, tk.E))
        
        # Quick templates
        template_frame = ttk.LabelFrame(input_frame, text="Quick Templates", padding="10")
        template_frame.grid(row=3, column=0, columnspan=2, sticky=(tk.W, tk.E), pady=(10, 0))
        
        templates = [
            ("ðŸ“Š Sort Array", "Create a function that sorts arrays with error handling"),
            ("ðŸŒ API Call", "Create a function to fetch data from API with error handling"),
            ("âœ… Input Validation", "Create email and password validation functions"),
            ("ðŸ§® Calculator", "Create a calculator class with basic operations"),
            ("ðŸ—„ï¸ Database", "Create database connection and query functions"),
            ("ðŸ” Authentication", "Create user authentication system with password hashing")
        ]
        
        for i, (text, template) in enumerate(templates):
            btn = ttk.Button(template_frame, text=text, 
                           command=lambda t=template: self.load_template(t))
            btn.grid(row=i//2, column=i%2, padx=5, pady=2, sticky=(tk.W, tk.E))
        
        # Output section
        output_frame = ttk.LabelFrame(main_frame, text="Generated Code", padding="15")
        output_frame.grid(row=1, column=1, sticky=(tk.W, tk.E, tk.N, tk.S))
        
        self.code_output = scrolledtext.ScrolledText(output_frame, width=45, height=20, 
                                                   font=('Courier New', 9), wrap=tk.WORD)
        self.code_output.grid(row=0, column=0, sticky=(tk.W, tk.E, tk.N, tk.S))
        
        # Copy button
        copy_btn = ttk.Button(output_frame, text="Copy Code to Clipboard", command=self.copy_to_clipboard)
        copy_btn.grid(row=1, column=0, pady=(10, 0), sticky=(tk.W, tk.E))
        
        # Configure grid weights
        self.root.columnconfigure(0, weight=1)
        self.root.rowconfigure(0, weight=1)
        main_frame.columnconfigure(0, weight=1)
        main_frame.columnconfigure(1, weight=1)
        main_frame.rowconfigure(1, weight=1)
        input_frame.columnconfigure(0, weight=1)
        input_frame.columnconfigure(1, weight=1)
        input_frame.rowconfigure(0, weight=1)
        output_frame.columnconfigure(0, weight=1)
        output_frame.rowconfigure(0, weight=1)
    
    def load_template(self, template):
        self.requirement_text.delete('1.0', tk.END)
        self.requirement_text.insert('1.0', template)
    
    def generate_code(self):
        requirement = self.requirement_text.get('1.0', tk.END).strip()
        language = self.language_var.get()
        
        if not requirement:
            messagebox.showwarning("Input Required", "Please enter a requirement!")
            return
        
        # Generate code using offline generator
        generated_code = self.generator.generate_code(requirement, language)
        
        # Display code
        self.code_output.delete('1.0', tk.END)
        self.code_output.insert('1.0', generated_code)
        
        # Show detected requirement type
        req_type = self.generator.detect_requirement_type(requirement)
        self.root.title(f"ðŸš€ Requirement2Code - Detected: {req_type}")
    
    def copy_to_clipboard(self):
        code = self.code_output.get('1.0', tk.END)
        if code.strip():
            self.root.clipboard_clear()
            self.root.clipboard_append(code)
            messagebox.showinfo("Success", "Code copied to clipboard!")
        else:
            messagebox.showwarning("No Code", "No code to copy!")

def main():
    try:
        root = tk.Tk()
        app = Requirement2CodeOffline(root)
        root.mainloop()
    except Exception as e:
        print(f"Error starting application: {e}")
        print("Please ensure you have Python with Tkinter installed")

if __name__ == "__main__":
    main()